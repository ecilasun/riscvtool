// Use NekoYon GPU assembler to compile

// Prologue
_start:
  jmp zero                    // Halt until CPU overwrites with noop

_main:
  vpage zero                  // Writes go to V-RAM page 0 (page 1 is visible)

uploadDefaultVGAPalette:
  dma.p zero, zero, 0x100     // DMA 256 palette entries form GRAM address zero (0x20000000) to palette starting at zero

// TODO: Something to draw a bitmap on current V-RAM page using DMA from G-RAM

flipPage:
  setregi r8, 0x00000001      // Writes go to V-RAM page 1 (page 2 is visible)
  vpage r8

// Epilogue
_exit:
  store.w zero, zero          // Write HALT at G-RAM address 0x0000
  setregi r1, 0x0000FFF8      // Set mailbox address
  store.w r1, zero            // Write 'done' (0x0) to mailbox
  jmp zero                    // Branch to top of G-RAM and halt


// Color palette, starts at GRAMStart
@ORG 0x20000000:
dw
0x00000000, 0x000000AA, 0x00AA0000, 0x00AA00AA,
0x0000AA00, 0x0000AAAA, 0x0055AA00, 0x00AAAAAA,
0x00555555, 0x005555FF, 0x00FF5555, 0x00FF55FF,
0x0055FF55, 0x0055FFFF, 0x00FFFF55, 0x00FFFFFF,
0x00000000, 0x00101010, 0x00202020, 0x00353535,
0x00454545, 0x00555555, 0x00656565, 0x00757575,
0x008A8A8A, 0x009A9A9A, 0x00AAAAAA, 0x00BABABA,
0x00CACACA, 0x00DFDFDF, 0x00EFEFEF, 0x00FFFFFF,
0x000000FF, 0x000041FF, 0x000082FF, 0x0000BEFF,
0x0000FFFF, 0x0000FFBE, 0x0000FF82, 0x0000FF41,
0x0000FF00, 0x0041FF00, 0x0082FF00, 0x00BEFF00,
0x00FFFF00, 0x00FFBE00, 0x00FF8200, 0x00FF4100,
0x00FF0000, 0x00FF0041, 0x00FF0082, 0x00FF00BE,
0x00FF00FF, 0x00BE00FF, 0x008200FF, 0x004100FF,
0x008282FF, 0x00829EFF, 0x0082BEFF, 0x0082DFFF,
0x0082FFFF, 0x0082FFDF, 0x0082FFBE, 0x0082FF9E,
0x0082FF82, 0x009EFF82, 0x00BEFF82, 0x00DFFF82,
0x00FFFF82, 0x00FFDF82, 0x00FFBE82, 0x00FF9E82,
0x00FF8282, 0x00FF829E, 0x00FF82BE, 0x00FF82DF,
0x00FF82FF, 0x00DF82FF, 0x00BE82FF, 0x009E82FF,
0x00BABAFF, 0x00BACAFF, 0x00BADFFF, 0x00BAEFFF,
0x00BAFFFF, 0x00BAFFEF, 0x00BAFFDF, 0x00BAFFCA,
0x00BAFFBA, 0x00CAFFBA, 0x00DFFFBA, 0x00EFFFBA,
0x00FFFFBA, 0x00FFEFBA, 0x00FFDFBA, 0x00FFCABA,
0x00FFBABA, 0x00FFBACA, 0x00FFBADF, 0x00FFBAEF,
0x00FFBAFF, 0x00EFBAFF, 0x00DFBAFF, 0x00CABAFF,
0x00000071, 0x00001C71, 0x00003971, 0x00005571,
0x00007171, 0x00007155, 0x00007139, 0x0000711C,
0x00007100, 0x001C7100, 0x00397100, 0x00557100,
0x00717100, 0x00715500, 0x00713900, 0x00711C00,
0x00710000, 0x0071001C, 0x00710039, 0x00710055,
0x00710071, 0x00550071, 0x00390071, 0x001C0071,
0x00393971, 0x00394571, 0x00395571, 0x00396171,
0x00397171, 0x00397161, 0x00397155, 0x00397145,
0x00397139, 0x00457139, 0x00557139, 0x00617139,
0x00717139, 0x00716139, 0x00715539, 0x00714539,
0x00713939, 0x00713945, 0x00713955, 0x00713961,
0x00713971, 0x00613971, 0x00553971, 0x00453971,
0x00515171, 0x00515971, 0x00516171, 0x00516971,
0x00517171, 0x00517169, 0x00517161, 0x00517159,
0x00517151, 0x00597151, 0x00617151, 0x00697151,
0x00717151, 0x00716951, 0x00716151, 0x00715951,
0x00715151, 0x00715159, 0x00715161, 0x00715169,
0x00715171, 0x00695171, 0x00615171, 0x00595171,
0x00000041, 0x00001041, 0x00002041, 0x00003141,
0x00004141, 0x00004131, 0x00004120, 0x00004110,
0x00004100, 0x00104100, 0x00204100, 0x00314100,
0x00414100, 0x00413100, 0x00412000, 0x00411000,
0x00410000, 0x00410010, 0x00410020, 0x00410031,
0x00410041, 0x00310041, 0x00200041, 0x00100041,
0x00202041, 0x00202841, 0x00203141, 0x00203941,
0x00204141, 0x00204139, 0x00204131, 0x00204128,
0x00204120, 0x00284120, 0x00314120, 0x00394120,
0x00414120, 0x00413920, 0x00413120, 0x00412820,
0x00412020, 0x00412028, 0x00412031, 0x00412039,
0x00412041, 0x00392041, 0x00312041, 0x00282041,
0x002D2D41, 0x002D3141, 0x002D3541, 0x002D3D41,
0x002D4141, 0x002D413D, 0x002D4135, 0x002D4131,
0x002D412D, 0x0031412D, 0x0035412D, 0x003D412D,
0x0041412D, 0x00413D2D, 0x0041352D, 0x0041312D,
0x00412D2D, 0x00412D31, 0x00412D35, 0x00412D3D,
0x00412D41, 0x003D2D41, 0x00352D41, 0x00312D41,
0x00000000, 0x00000000, 0x00000000, 0x00000000,
0x00000000, 0x00000000, 0x00000000, 0x00000000;
